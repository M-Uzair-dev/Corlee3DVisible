import "./style.css";
import messages from "./messages.json";
import { useState } from "react";
import SvgIcon1 from "../PasswordInputWidget/icons/SvgIcon1";
import { toast } from "sonner";
import { useNavigate } from "react-router";
import { api } from "../../../../config/api";

function SecurePasswordForm(props) {
  const [password, setPassword] = useState("");
  const navigate = useNavigate();
  const [confirm, setConfirm] = useState("");
  const [showpassword, setShowpassword] = useState(false);
  const [loading, setloading] = useState(false);
  const [showcpassword, setShowcpassword] = useState(false);

  const resetPass = async () => {
    try {
      setloading(true);

      const res = await api.post("/password_reset/done/", {
        new_password1: password,
        new_password2: confirm,
        token: props.token,
        uid: props.uid,
      });
      if (res.status === 200) {
        toast.success("Password reset successfully");
        setloading(false);
        navigate("/success");
      } else {
        toast.error("An error occured");
        setloading(false);
      }
    } catch (e) {
      console.log(e);
      toast.error("An error occured");
      setloading(false);
    }
  };
  return (
    <div className="password-reset-form-container">
      <div className="nested-svg-container">
        <div className="flex-row-container">
          <input
            placeholder="New Password"
            type={showpassword ? "text" : "password"}
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            className="input-with-icon input-style-f62::placeholder"
          />
          <SvgIcon1
            className="svg-container"
            onClick={() => setShowpassword(!showpassword)}
          />
        </div>
      </div>
      <div className="text-content-container container2">
        <div className="text-grouping-container">
          <div className="text-content-container">
            {/[a-z]/.test(password) ? (
              <svg
                width="8"
                height="8"
                viewBox="0 0 8 8"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M7.36852 0.155199C7.22751 0.0765928 7.07242 0.026604 6.91211 0.00809158C6.7518 -0.0104208 6.58942 0.00290618 6.43425 0.0473106C6.27909 0.091715 6.13419 0.166326 6.00783 0.266876C5.88147 0.367427 5.77613 0.491944 5.69785 0.633308L3.41725 4.74492L2.11204 3.43735C1.99872 3.31981 1.86317 3.22606 1.71329 3.16156C1.56342 3.09706 1.40222 3.06311 1.23911 3.06169C1.076 3.06027 0.914241 3.09141 0.76327 3.15329C0.6123 3.21517 0.475142 3.30655 0.359801 3.4221C0.24446 3.53765 0.153244 3.67505 0.0914775 3.8263C0.0297106 3.97754 -0.00137101 4.13959 4.63818e-05 4.303C0.00146377 4.4664 0.0353518 4.62789 0.099733 4.77803C0.164114 4.92818 0.257699 5.06397 0.375027 5.1775L2.8319 7.6388C3.06408 7.87201 3.37733 8 3.70041 8L3.87055 7.98769C4.05884 7.96131 4.23844 7.8915 4.39522 7.78376C4.55201 7.67602 4.68169 7.5333 4.77406 7.36683L7.84516 1.82889C7.92356 1.68764 7.97343 1.5323 7.99191 1.37175C8.01039 1.21119 7.99712 1.04856 7.95286 0.893146C7.9086 0.737728 7.83422 0.592566 7.73396 0.465949C7.6337 0.339331 7.50952 0.233738 7.36852 0.155199Z"
                  fill="#319F43"
                />
              </svg>
            ) : password.length !== 0 ? (
              <svg
                width="8"
                height="8"
                viewBox="0 0 8 8"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M6.95712 7.72541C6.78423 7.89829 6.54974 7.99542 6.30524 7.99542C6.06073 7.99542 5.82624 7.89829 5.65335 7.72541L3.61663 5.39751L1.57991 7.72464C1.49455 7.81139 1.39287 7.88039 1.28072 7.92765C1.16856 7.97491 1.04816 7.9995 0.926463 7.99999C0.804761 8.00049 0.684166 7.97688 0.571632 7.93054C0.459099 7.88419 0.356855 7.81603 0.270798 7.72997C0.184742 7.64391 0.116575 7.54167 0.0702303 7.42914C0.0238858 7.3166 0.000280314 7.19601 0.000775872 7.07431C0.00127143 6.9526 0.025858 6.83221 0.0731175 6.72005C0.120377 6.6079 0.189374 6.50622 0.276129 6.42086L2.39506 4.00077L0.275361 1.57914C0.188606 1.49379 0.119609 1.3921 0.0723493 1.27995C0.0250898 1.1678 0.000503201 1.0474 7.64362e-06 0.925695C-0.000487914 0.803993 0.0231175 0.683397 0.0694621 0.570864C0.115807 0.458331 0.183973 0.356087 0.27003 0.27003C0.356087 0.183973 0.458331 0.115807 0.570864 0.0694621C0.683397 0.0231175 0.803993 -0.000487914 0.925695 7.64362e-06C1.0474 0.000503201 1.1678 0.0250898 1.27995 0.0723493C1.3921 0.119609 1.49379 0.188606 1.57914 0.275361L3.61663 2.60403L5.65335 0.275361C5.7387 0.188606 5.84039 0.119609 5.95254 0.0723493C6.06469 0.0250898 6.18509 0.000503201 6.30679 7.64362e-06C6.42849 -0.000487914 6.54909 0.0231175 6.66162 0.0694621C6.77415 0.115807 6.8764 0.183973 6.96245 0.27003C7.04851 0.356087 7.11668 0.458331 7.16302 0.570864C7.20937 0.683397 7.23297 0.803993 7.23248 0.925695C7.23198 1.0474 7.20739 1.1678 7.16014 1.27995C7.11288 1.3921 7.04388 1.49379 6.95712 1.57914L4.8382 4.00077L6.95712 6.42086C7.04284 6.50649 7.11084 6.60817 7.15724 6.72009C7.20364 6.83201 7.22752 6.95198 7.22752 7.07314C7.22752 7.19429 7.20364 7.31426 7.15724 7.42618C7.11084 7.53811 7.04284 7.63978 6.95712 7.72541Z"
                  fill="#E33629"
                />
              </svg>
            ) : (
              <img
                src="https://d2e8m995jm0i5z.cloudfront.net/websiteimages/img_1091_3147_dc1186.svg"
                alt=""
                className="text-image-block"
              />
            )}

            <p className="text-styler">{messages["lowercase_characters"]}</p>
          </div>
          <div className="text-block-container">
            {/[0-9]/.test(password) ? (
              <svg
                width="8"
                height="8"
                viewBox="0 0 8 8"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M7.36852 0.155199C7.22751 0.0765928 7.07242 0.026604 6.91211 0.00809158C6.7518 -0.0104208 6.58942 0.00290618 6.43425 0.0473106C6.27909 0.091715 6.13419 0.166326 6.00783 0.266876C5.88147 0.367427 5.77613 0.491944 5.69785 0.633308L3.41725 4.74492L2.11204 3.43735C1.99872 3.31981 1.86317 3.22606 1.71329 3.16156C1.56342 3.09706 1.40222 3.06311 1.23911 3.06169C1.076 3.06027 0.914241 3.09141 0.76327 3.15329C0.6123 3.21517 0.475142 3.30655 0.359801 3.4221C0.24446 3.53765 0.153244 3.67505 0.0914775 3.8263C0.0297106 3.97754 -0.00137101 4.13959 4.63818e-05 4.303C0.00146377 4.4664 0.0353518 4.62789 0.099733 4.77803C0.164114 4.92818 0.257699 5.06397 0.375027 5.1775L2.8319 7.6388C3.06408 7.87201 3.37733 8 3.70041 8L3.87055 7.98769C4.05884 7.96131 4.23844 7.8915 4.39522 7.78376C4.55201 7.67602 4.68169 7.5333 4.77406 7.36683L7.84516 1.82889C7.92356 1.68764 7.97343 1.5323 7.99191 1.37175C8.01039 1.21119 7.99712 1.04856 7.95286 0.893146C7.9086 0.737728 7.83422 0.592566 7.73396 0.465949C7.6337 0.339331 7.50952 0.233738 7.36852 0.155199Z"
                  fill="#319F43"
                />
              </svg>
            ) : password.length !== 0 ? (
              <svg
                width="8"
                height="8"
                viewBox="0 0 8 8"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M6.95712 7.72541C6.78423 7.89829 6.54974 7.99542 6.30524 7.99542C6.06073 7.99542 5.82624 7.89829 5.65335 7.72541L3.61663 5.39751L1.57991 7.72464C1.49455 7.81139 1.39287 7.88039 1.28072 7.92765C1.16856 7.97491 1.04816 7.9995 0.926463 7.99999C0.804761 8.00049 0.684166 7.97688 0.571632 7.93054C0.459099 7.88419 0.356855 7.81603 0.270798 7.72997C0.184742 7.64391 0.116575 7.54167 0.0702303 7.42914C0.0238858 7.3166 0.000280314 7.19601 0.000775872 7.07431C0.00127143 6.9526 0.025858 6.83221 0.0731175 6.72005C0.120377 6.6079 0.189374 6.50622 0.276129 6.42086L2.39506 4.00077L0.275361 1.57914C0.188606 1.49379 0.119609 1.3921 0.0723493 1.27995C0.0250898 1.1678 0.000503201 1.0474 7.64362e-06 0.925695C-0.000487914 0.803993 0.0231175 0.683397 0.0694621 0.570864C0.115807 0.458331 0.183973 0.356087 0.27003 0.27003C0.356087 0.183973 0.458331 0.115807 0.570864 0.0694621C0.683397 0.0231175 0.803993 -0.000487914 0.925695 7.64362e-06C1.0474 0.000503201 1.1678 0.0250898 1.27995 0.0723493C1.3921 0.119609 1.49379 0.188606 1.57914 0.275361L3.61663 2.60403L5.65335 0.275361C5.7387 0.188606 5.84039 0.119609 5.95254 0.0723493C6.06469 0.0250898 6.18509 0.000503201 6.30679 7.64362e-06C6.42849 -0.000487914 6.54909 0.0231175 6.66162 0.0694621C6.77415 0.115807 6.8764 0.183973 6.96245 0.27003C7.04851 0.356087 7.11668 0.458331 7.16302 0.570864C7.20937 0.683397 7.23297 0.803993 7.23248 0.925695C7.23198 1.0474 7.20739 1.1678 7.16014 1.27995C7.11288 1.3921 7.04388 1.49379 6.95712 1.57914L4.8382 4.00077L6.95712 6.42086C7.04284 6.50649 7.11084 6.60817 7.15724 6.72009C7.20364 6.83201 7.22752 6.95198 7.22752 7.07314C7.22752 7.19429 7.20364 7.31426 7.15724 7.42618C7.11084 7.53811 7.04284 7.63978 6.95712 7.72541Z"
                  fill="#E33629"
                />
              </svg>
            ) : (
              <img
                src="https://d2e8m995jm0i5z.cloudfront.net/websiteimages/img_1091_3150_903815.svg"
                alt=""
                className="text-image-block"
              />
            )}

            <p className="text-styler">{messages["numbers"]}</p>
          </div>
        </div>
        <div className="vertical-text-block">
          <div className="text-content-container">
            {/[A-Z]/.test(password) ? (
              <svg
                width="8"
                height="8"
                viewBox="0 0 8 8"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M7.36852 0.155199C7.22751 0.0765928 7.07242 0.026604 6.91211 0.00809158C6.7518 -0.0104208 6.58942 0.00290618 6.43425 0.0473106C6.27909 0.091715 6.13419 0.166326 6.00783 0.266876C5.88147 0.367427 5.77613 0.491944 5.69785 0.633308L3.41725 4.74492L2.11204 3.43735C1.99872 3.31981 1.86317 3.22606 1.71329 3.16156C1.56342 3.09706 1.40222 3.06311 1.23911 3.06169C1.076 3.06027 0.914241 3.09141 0.76327 3.15329C0.6123 3.21517 0.475142 3.30655 0.359801 3.4221C0.24446 3.53765 0.153244 3.67505 0.0914775 3.8263C0.0297106 3.97754 -0.00137101 4.13959 4.63818e-05 4.303C0.00146377 4.4664 0.0353518 4.62789 0.099733 4.77803C0.164114 4.92818 0.257699 5.06397 0.375027 5.1775L2.8319 7.6388C3.06408 7.87201 3.37733 8 3.70041 8L3.87055 7.98769C4.05884 7.96131 4.23844 7.8915 4.39522 7.78376C4.55201 7.67602 4.68169 7.5333 4.77406 7.36683L7.84516 1.82889C7.92356 1.68764 7.97343 1.5323 7.99191 1.37175C8.01039 1.21119 7.99712 1.04856 7.95286 0.893146C7.9086 0.737728 7.83422 0.592566 7.73396 0.465949C7.6337 0.339331 7.50952 0.233738 7.36852 0.155199Z"
                  fill="#319F43"
                />
              </svg>
            ) : password.length !== 0 ? (
              <svg
                width="8"
                height="8"
                viewBox="0 0 8 8"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M6.95712 7.72541C6.78423 7.89829 6.54974 7.99542 6.30524 7.99542C6.06073 7.99542 5.82624 7.89829 5.65335 7.72541L3.61663 5.39751L1.57991 7.72464C1.49455 7.81139 1.39287 7.88039 1.28072 7.92765C1.16856 7.97491 1.04816 7.9995 0.926463 7.99999C0.804761 8.00049 0.684166 7.97688 0.571632 7.93054C0.459099 7.88419 0.356855 7.81603 0.270798 7.72997C0.184742 7.64391 0.116575 7.54167 0.0702303 7.42914C0.0238858 7.3166 0.000280314 7.19601 0.000775872 7.07431C0.00127143 6.9526 0.025858 6.83221 0.0731175 6.72005C0.120377 6.6079 0.189374 6.50622 0.276129 6.42086L2.39506 4.00077L0.275361 1.57914C0.188606 1.49379 0.119609 1.3921 0.0723493 1.27995C0.0250898 1.1678 0.000503201 1.0474 7.64362e-06 0.925695C-0.000487914 0.803993 0.0231175 0.683397 0.0694621 0.570864C0.115807 0.458331 0.183973 0.356087 0.27003 0.27003C0.356087 0.183973 0.458331 0.115807 0.570864 0.0694621C0.683397 0.0231175 0.803993 -0.000487914 0.925695 7.64362e-06C1.0474 0.000503201 1.1678 0.0250898 1.27995 0.0723493C1.3921 0.119609 1.49379 0.188606 1.57914 0.275361L3.61663 2.60403L5.65335 0.275361C5.7387 0.188606 5.84039 0.119609 5.95254 0.0723493C6.06469 0.0250898 6.18509 0.000503201 6.30679 7.64362e-06C6.42849 -0.000487914 6.54909 0.0231175 6.66162 0.0694621C6.77415 0.115807 6.8764 0.183973 6.96245 0.27003C7.04851 0.356087 7.11668 0.458331 7.16302 0.570864C7.20937 0.683397 7.23297 0.803993 7.23248 0.925695C7.23198 1.0474 7.20739 1.1678 7.16014 1.27995C7.11288 1.3921 7.04388 1.49379 6.95712 1.57914L4.8382 4.00077L6.95712 6.42086C7.04284 6.50649 7.11084 6.60817 7.15724 6.72009C7.20364 6.83201 7.22752 6.95198 7.22752 7.07314C7.22752 7.19429 7.20364 7.31426 7.15724 7.42618C7.11084 7.53811 7.04284 7.63978 6.95712 7.72541Z"
                  fill="#E33629"
                />
              </svg>
            ) : (
              <img
                src="https://d2e8m995jm0i5z.cloudfront.net/websiteimages/img_1091_3154_932af4.svg"
                alt=""
                className="text-image-block"
              />
            )}

            <p className="text-styler">{messages["uppercase_characters"]}</p>
          </div>
          <div className="text-block-container">
            {password.length >= 8 ? (
              <svg
                width="8"
                height="8"
                viewBox="0 0 8 8"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M7.36852 0.155199C7.22751 0.0765928 7.07242 0.026604 6.91211 0.00809158C6.7518 -0.0104208 6.58942 0.00290618 6.43425 0.0473106C6.27909 0.091715 6.13419 0.166326 6.00783 0.266876C5.88147 0.367427 5.77613 0.491944 5.69785 0.633308L3.41725 4.74492L2.11204 3.43735C1.99872 3.31981 1.86317 3.22606 1.71329 3.16156C1.56342 3.09706 1.40222 3.06311 1.23911 3.06169C1.076 3.06027 0.914241 3.09141 0.76327 3.15329C0.6123 3.21517 0.475142 3.30655 0.359801 3.4221C0.24446 3.53765 0.153244 3.67505 0.0914775 3.8263C0.0297106 3.97754 -0.00137101 4.13959 4.63818e-05 4.303C0.00146377 4.4664 0.0353518 4.62789 0.099733 4.77803C0.164114 4.92818 0.257699 5.06397 0.375027 5.1775L2.8319 7.6388C3.06408 7.87201 3.37733 8 3.70041 8L3.87055 7.98769C4.05884 7.96131 4.23844 7.8915 4.39522 7.78376C4.55201 7.67602 4.68169 7.5333 4.77406 7.36683L7.84516 1.82889C7.92356 1.68764 7.97343 1.5323 7.99191 1.37175C8.01039 1.21119 7.99712 1.04856 7.95286 0.893146C7.9086 0.737728 7.83422 0.592566 7.73396 0.465949C7.6337 0.339331 7.50952 0.233738 7.36852 0.155199Z"
                  fill="#319F43"
                />
              </svg>
            ) : password.length !== 0 ? (
              <svg
                width="8"
                height="8"
                viewBox="0 0 8 8"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M6.95712 7.72541C6.78423 7.89829 6.54974 7.99542 6.30524 7.99542C6.06073 7.99542 5.82624 7.89829 5.65335 7.72541L3.61663 5.39751L1.57991 7.72464C1.49455 7.81139 1.39287 7.88039 1.28072 7.92765C1.16856 7.97491 1.04816 7.9995 0.926463 7.99999C0.804761 8.00049 0.684166 7.97688 0.571632 7.93054C0.459099 7.88419 0.356855 7.81603 0.270798 7.72997C0.184742 7.64391 0.116575 7.54167 0.0702303 7.42914C0.0238858 7.3166 0.000280314 7.19601 0.000775872 7.07431C0.00127143 6.9526 0.025858 6.83221 0.0731175 6.72005C0.120377 6.6079 0.189374 6.50622 0.276129 6.42086L2.39506 4.00077L0.275361 1.57914C0.188606 1.49379 0.119609 1.3921 0.0723493 1.27995C0.0250898 1.1678 0.000503201 1.0474 7.64362e-06 0.925695C-0.000487914 0.803993 0.0231175 0.683397 0.0694621 0.570864C0.115807 0.458331 0.183973 0.356087 0.27003 0.27003C0.356087 0.183973 0.458331 0.115807 0.570864 0.0694621C0.683397 0.0231175 0.803993 -0.000487914 0.925695 7.64362e-06C1.0474 0.000503201 1.1678 0.0250898 1.27995 0.0723493C1.3921 0.119609 1.49379 0.188606 1.57914 0.275361L3.61663 2.60403L5.65335 0.275361C5.7387 0.188606 5.84039 0.119609 5.95254 0.0723493C6.06469 0.0250898 6.18509 0.000503201 6.30679 7.64362e-06C6.42849 -0.000487914 6.54909 0.0231175 6.66162 0.0694621C6.77415 0.115807 6.8764 0.183973 6.96245 0.27003C7.04851 0.356087 7.11668 0.458331 7.16302 0.570864C7.20937 0.683397 7.23297 0.803993 7.23248 0.925695C7.23198 1.0474 7.20739 1.1678 7.16014 1.27995C7.11288 1.3921 7.04388 1.49379 6.95712 1.57914L4.8382 4.00077L6.95712 6.42086C7.04284 6.50649 7.11084 6.60817 7.15724 6.72009C7.20364 6.83201 7.22752 6.95198 7.22752 7.07314C7.22752 7.19429 7.20364 7.31426 7.15724 7.42618C7.11084 7.53811 7.04284 7.63978 6.95712 7.72541Z"
                  fill="#E33629"
                />
              </svg>
            ) : (
              <img
                src="https://d2e8m995jm0i5z.cloudfront.net/websiteimages/img_1091_3157_9e00ec.svg"
                alt=""
                className="text-image-block"
              />
            )}

            <p className="text-styler">{messages["8_characters_minimum"]}</p>
          </div>
        </div>
      </div>
      <div className="nested-svg-container">
        {/* Input Component is detected here. We've generated code using HTML. See other options in "Component library" dropdown in Settings */}
        <div className="flex-row-container">
          <input
            placeholder="Confirm new password"
            type={showcpassword ? "text" : "password"}
            className="input-with-icon input-style-f62::placeholder"
            value={confirm}
            onChange={(e) => setConfirm(e.target.value)}
          />
          <SvgIcon1
            className="svg-container"
            onClick={() => {
              setShowcpassword(!showcpassword);
            }}
          />
        </div>
      </div>
      {/* Button Component is detected here. We've generated code using HTML. See other options in "Component library" dropdown in Settings */}
      <button
        className="password-reset-button"
        onClick={() => {
          if (
            /[a-z]/.test(password) &&
            /[0-9]/.test(password) &&
            /[A-Z]/.test(password) &&
            password.length >= 8
          ) {
            if (confirm === "") {
              toast.error("Please confirm your password");
            } else if (confirm === password) {
              resetPass();
            } else {
              toast.error("Passwords do not match");
            }
          } else {
            toast.error("Passwords do not meet requirements");
          }
        }}
        disabled={loading}
        style={
          /[a-z]/.test(password) &&
          /[0-9]/.test(password) &&
          /[A-Z]/.test(password) &&
          password.length >= 8 &&
          confirm === password
            ? {}
            : { opacity: 0.5, cursor: "not-allowed" }
        }
      >
        {loading ? "Loading..." : messages["reset_password"]}
      </button>
    </div>
  );
}

export default SecurePasswordForm;
